import{b as Ie,a as qe,i as Be}from"./navigation.e609b1a8.js";import{p as ne}from"./stores.f92608b4.js";import{k as z,w as H}from"./singletons.a2a3f4d4.js";import{ag as _,ah as he,Y as Oe}from"./scheduler.be341df6.js";import{U as je,N as We,P as Ye,a as Ge,b as xe,H as Je,p as Ke}from"./parse.7d180a0f.js";import{e as Xe,a as de}from"./forms.7281ce72.js";const Qe=!0;class me extends Error{constructor(t,n){super(t),this.name="DevalueError",this.path=n.join("")}}function Ae(e){return Object(e)!==e}const ze=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function et(e){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null||Object.getOwnPropertyNames(t).sort().join("\0")===ze}function tt(e){return Object.prototype.toString.call(e).slice(8,-1)}function rt(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function ee(e){let t="",n=0;const i=e.length;for(let o=0;o<i;o+=1){const s=e[o],r=rt(s);r&&(t+=e.slice(n,o)+r,n=o+1)}return`"${n===0?e:t+e.slice(n)}"`}function Ve(e,t){const n=[],i=new Map,o=[];for(const l in t)o.push({key:l,fn:t[l]});const s=[];let r=0;function u(l){if(typeof l=="function")throw new me("Cannot stringify a function",s);if(i.has(l))return i.get(l);if(l===void 0)return je;if(Number.isNaN(l))return We;if(l===1/0)return Ye;if(l===-1/0)return Ge;if(l===0&&1/l<0)return xe;const v=r++;i.set(l,v);for(const{key:d,fn:g}of o){const p=g(l);if(p)return n[v]=`["${d}",${u(p)}]`,v}let m="";if(Ae(l))m=ye(l);else switch(tt(l)){case"Number":case"String":case"Boolean":m=`["Object",${ye(l)}]`;break;case"BigInt":m=`["BigInt",${l}]`;break;case"Date":m=`["Date","${l.toISOString()}"]`;break;case"RegExp":const{source:g,flags:p}=l;m=p?`["RegExp",${ee(g)},"${p}"]`:`["RegExp",${ee(g)}]`;break;case"Array":m="[";for(let h=0;h<l.length;h+=1)h>0&&(m+=","),h in l?(s.push(`[${h}]`),m+=u(l[h]),s.pop()):m+=Je;m+="]";break;case"Set":m='["Set"';for(const h of l)m+=`,${u(h)}`;m+="]";break;case"Map":m='["Map"';for(const[h,I]of l)s.push(`.get(${Ae(h)?ye(h):"..."})`),m+=`,${u(h)},${u(I)}`;m+="]";break;default:if(!et(l))throw new me("Cannot stringify arbitrary non-POJOs",s);if(Object.getOwnPropertySymbols(l).length>0)throw new me("Cannot stringify POJOs with symbolic keys",s);if(Object.getPrototypeOf(l)===null){m='["null"';for(const h in l)s.push(`.${h}`),m+=`,${ee(h)},${u(l[h])}`,s.pop();m+="]"}else{m="{";let h=!1;for(const I in l)h&&(m+=","),h=!0,s.push(`.${I}`),m+=`${ee(I)}:${u(l[I])}`,s.pop();m+="}"}}return n[v]=m,v}const f=u(e);return f<0?`${f}`:`[${n.join(",")}]`}function ye(e){const t=typeof e;return t==="string"?ee(e):e instanceof String?ee(e.toString()):e===void 0?je.toString():e===0&&1/e<0?xe.toString():t==="bigint"?`["BigInt","${e}"]`:String(e)}const $e=Qe;function ue(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function be(e){return e.reduce((t,n)=>{const i=String(n);return typeof n=="number"||/^\d+$/.test(i)?t+=`[${i}]`:t?t+=`.${i}`:t+=i,t},"")}class U extends Error{constructor(t){super(t),Object.setPrototypeOf(this,U.prototype)}}function fe(e,t,n){return e[t]=n,"skip"}function we(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function nt(e,t,n={}){n.modifier||(n.modifier=o=>we(t,o)?void 0:o.value);const i=V(e,t,n.modifier);if(i)return n.value===void 0||n.value(i.value)?i:void 0}function V(e,t,n){if(!t.length)return;const i=[t[0]];let o=e;for(;i.length<t.length;){const r=i[i.length-1],u=n?n({parent:o,key:String(r),value:o[r],path:i.map(f=>String(f)),isLeaf:!1,set:f=>fe(o,r,f)}):o[r];if(u===void 0)return;o=u,i.push(t[i.length])}const s=t[t.length-1];return{parent:o,key:String(s),value:o[s],path:t.map(r=>String(r)),isLeaf:!0,set:r=>fe(o,s,r)}}function q(e,t,n=[]){for(const i in e){const o=e[i],s=o===null||typeof o!="object",r={parent:e,key:i,value:o,path:n.map(String).concat([i]),isLeaf:s,set:f=>fe(e,i,f)},u=t(r);if(u==="abort")return u;if(u==="skip")continue;if(!s){const f=q(o,t,r.path);if(f==="abort")return f}}}async function at(e,t,n=[]){for(const i in e){const o=e[i],s=o===null||typeof o!="object",r={parent:e,key:i,value:o,path:n.map(String).concat([i]),isLeaf:s,set:f=>fe(e,i,f)},u=await t(r);if(u==="abort")return u;if(u==="skip")break;if(!s){const f=q(o,t,r.path);if(f==="abort")return f}}}function it(e,t){return e===t||e.size===t.size&&[...e].every(n=>t.has(n))}function st(e,t){const n=new Map;function i(o,s){const r=V(s,o.path);function u(){n.set(o.path.join(" "),o.path)}o.isLeaf?r?o.value!==r.value&&u():u():r&&(o.value instanceof Date&&r.value instanceof Date&&o.value.getTime()!=r.value.getTime()||o.value instanceof Set&&r.value instanceof Set&&!it(o.value,r.value))&&u()}return q(e,o=>i(o,t)),q(t,o=>i(o,e)),Array.from(n.values())}function J(e,t,n){for(const i of t){const o=V(e,i,({parent:s,key:r,value:u})=>((u===void 0||typeof u!="object")&&(s[r]={}),s[r]));o&&(o.parent[o.key]=n)}}const ot={trueStringValue:"true",dateFormat:"iso",emptyIfZero:!0};function Mt(e,t,n={format:"iso"}){return ut(e,t,"date",{...ot,dateFormat:n.format,empty:n.empty})}function ut(e,t,n,i){function o(u){if(!u&&i.empty!==void 0&&(u!==0||i.emptyIfZero))return i.empty==="null"?null:void 0;if(typeof u=="number"&&(u=u.toString()),typeof u!="string")throw new U("stringProxy received a non-string value.");if(n=="string")return u;if(n=="boolean")return!!u;if(n=="date")return new Date(u);const f=i.delimiter?u.replace(i.delimiter,"."):u;let l;return n=="number"?l=parseFloat(f):l=parseInt(f,10),i.empty!==void 0&&(l===0&&i.emptyIfZero||isNaN(l))?i.empty=="null"?null:void 0:l}const s=oe(e,t);return{subscribe:z(s,u=>{if(u==null)return"";if(n=="string")return u;if(n=="int"||n=="number"){const f=u;return isNaN(f)?"":String(f)}else if(n=="date"){const f=u;if(isNaN(f))return"";switch(i.dateFormat){case"iso":return f.toISOString();case"date":return f.toISOString().slice(0,10);case"datetime":return f.toISOString().slice(0,16);case"time":return f.toISOString().slice(11,16);case"date-utc":return Me(f);case"datetime-utc":return Me(f)+"T"+ke(f);case"time-utc":return ke(f);case"date-local":return Fe(f);case"datetime-local":return Fe(f)+"T"+Pe(f);case"time-local":return Pe(f)}}else return u?i.trueStringValue:""}).subscribe,set(u){s.set(o(u))},update(u){s.update(f=>o(u(String(f))))}}}function oe(e,t){const n=ue(t),i=z(e,o=>{const s=V(o,n);return s==null?void 0:s.value});return{subscribe(...o){const s=i.subscribe(...o);return()=>s()},update(o){e.update(s=>{const r=V(s,n,({parent:u,key:f,value:l})=>(l===void 0&&(u[f]=/\D/.test(f)?{}:[]),u[f]));return r&&(r.parent[r.key]=o(r.value)),s})},set(o){e.update(s=>{const r=V(s,n,({parent:u,key:f,value:l})=>(l===void 0&&(u[f]=/\D/.test(f)?{}:[]),u[f]));return r&&(r.parent[r.key]=o),s})}}}function Fe(e){return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")}function Pe(e){return String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")}function Me(e){return e.getUTCFullYear()+"-"+String(e.getUTCMonth()+1).padStart(2,"0")+"-"+String(e.getUTCDate()).padStart(2,"0")}function ke(e){return String(e.getUTCHours()).padStart(2,"0")+":"+String(e.getUTCMinutes()).padStart(2,"0")}function G(e){return"structuredClone"in globalThis?structuredClone(e):Ke(Ve(e))}function ft(e){const t=e;let n=!0,i=!1,o=!1,s=!1,r,u;for(;n;)e._def.typeName=="ZodNullable"?(i=!0,e=e.unwrap()):e._def.typeName=="ZodDefault"?(s=!0,u=e._def.defaultValue(),e=e._def.innerType):e._def.typeName=="ZodOptional"?(o=!0,e=e.unwrap()):e._def.typeName=="ZodEffects"?(r||(r=e),e=e._def.schema):e._def.typeName=="ZodPipeline"?e=e._def.out:n=!1;return{zodType:e,originalType:t,isNullable:i,isOptional:o,hasDefault:s,defaultValue:u,effects:r}}const ge=new WeakMap;function ve(e){return ge.has(e)||ge.set(e,re(e)),ge.get(e)}function re(e){const t=ft(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([n,i])=>[n,re(i)]).filter(n=>n[1]!==void 0));if(t._def.typeName=="ZodArray")return re(t._def.type)??{};if(t._def.typeName=="ZodRecord")return re(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((i,o)=>{const s=re(o);return s&&(i={...i??{},...s}),i},void 0)}function le(e,t,n=!0){const i={},o=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!n)return e._errors;i._errors=e._errors}for(const[s,r]of o.filter(([u])=>u!=="_errors")){const u=/^\d+$/.test(s);i[s]=le(r,t?u?t:t[s]:void 0,!!(t!=null&&t[s]))}return i}function lt(e){return Ue(e,[])}function Ue(e,t){return Object.entries(e).filter(([,i])=>i!==void 0).flatMap(([i,o])=>{if(Array.isArray(o)&&o.length>0){const s=t.concat([i]);return{path:be(s),messages:o}}else return Ue(e[i],t.concat([i]))})}function Se(e,t){e.update(n=>(q(n,i=>{if(!(i.path.length==1&&i.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(i.value))return i.set(void 0)}),t.undefinePath&&J(n,[t.undefinePath],void 0),n))}async function Re(e,t,n,i,o){return ct(e,t,n,i,o)}async function ct(e,t,n,i,o){let s=!0,r={};if(e)if("safeParseAsync"in e){const u=e,f=await u.safeParseAsync(t);s=f.success,f.success?t=f.data:r=le(f.error.format(),ve(u))}else{t={...t};for(const[l,v]of Object.entries(e))typeof v=="function"&&!(l in t)&&(t[l]=void 0);const u=e,f=[];await at(t,async({value:l,path:v})=>{const m=v.filter(g=>/\D/.test(String(g))),d=V(u,m);if(typeof(d==null?void 0:d.value)=="function"){const g=d.value;let p;if(Array.isArray(l))for(const h in l)try{p=await g(l[h]),p&&(s=!1,f.push({path:v.concat([h]),errors:typeof p=="string"?[p]:p??void 0}))}catch(I){s=!1,console.error(`Error in form validators for field "${v}":`,I)}else try{p=await g(l),p&&(s=!1,f.push({path:v,errors:typeof p=="string"?[p]:p??void 0}))}catch(h){s=!1,console.error(`Error in form validators for field "${v}":`,h)}}});for(const{path:l,errors:v}of f){const m=V(r,l,({parent:d,key:g,value:p})=>(p===void 0&&(d[g]={}),d[g]));if(m){const{parent:d,key:g}=m;d[g]=v}}}return{valid:s,posted:o,errors:r,data:t,constraints:i,message:void 0,id:n}}async function dt(e,t,n,i){if(typeof e.validators!="object"||!("safeParseAsync"in e.validators))return;const o=e.validators,s=await o.safeParseAsync(t);if(s.success)n.update(r=>(q(r,u=>{if(u.key=="_errors")return u.set(void 0)}),r));else{const r=le(s.error.format(),ve(o));n.update(u=>(q(u,f=>{if(f.key=="_errors")return f.set(void 0)}),q(r,f=>{if(f.key=="_errors"){const l=f.path.length==1?{value:!0}:i&&V(i,f.path.slice(0,-1));if(l&&l.value)return J(u,[f.path],f.value)}}),u))}}async function pe(e,t,n,i,o,s={}){function r(){Se(i,{undefinePath:e,clearFormLevelErrors:!0})}function u(l){return typeof l=="string"&&(l=[l]),(s.update===!0||s.update=="errors")&&i.update(v=>{const m=V(v,e,d=>{if(we(e,d))throw new U("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+d.path.slice(0,-1));return d.value===void 0?(d.parent[d.key]={},d.parent[d.key]):d.value});if(!m)throw new U("Error path could not be created: "+e);return m.parent[m.key]=l??void 0,v}),l??void 0}const f=await mt(e,t.validators,n,i,o,s);if(f.validated)if(f.validated==="all"&&!f.errors)r();else return f.errors=u(f.errors),f;else if(f.validated===!1&&t.defaultValidator=="clear")return f.errors=u(f.errors),f;return f}async function mt(e,t,n,i,o,s={}){s.update===void 0&&(s.update=!0),s.taint===void 0&&(s.taint=!1),typeof s.errors=="string"&&(s.errors=[s.errors]);const r={value:s.value,shouldUpdate:!0,currentData:void 0,validationPath:e.filter(d=>/\D/.test(String(d)))};async function u(){return{validated:!1,errors:void 0,data:void 0}}function f(d,g){if(g===void 0)return!1;const p=V(g,d);return p?p.value:!1}function l(d){i.update(d)}function v(){Se(i,{undefinePath:null,clearFormLevelErrors:!0})}function m(d,g){return le(d.format(),ve(g))}if("value"in s)s.update===!0||s.update==="value"?n.update(d=>(J(d,[e],r.value),r.currentData=d),{taint:s.taint}):r.shouldUpdate=!1;else{r.currentData=_(n);const d=V(r.currentData,e);r.value=d==null?void 0:d.value}if(typeof t!="object")return u();if("safeParseAsync"in t){r.shouldUpdate||(r.currentData=G(r.currentData??_(n)),J(r.currentData,[e],r.value));const d=await t.safeParseAsync(r.currentData);if(d.success)return v(),{validated:!0,errors:void 0,data:d.data};{const g=m(d.error,t);if(s.update===!0||s.update=="errors"){const h=_(o);l(I=>(q(I,P=>{if(P.key=="_errors")return P.set(void 0)}),q(g,P=>{if(P.key=="_errors"&&(P.path.length==1||f(P.path.slice(0,-1),h)))return J(I,[P.path],P.value);if(Array.isArray(P.value))return f(P.path,h)&&J(I,[P.path],P.value),"skip"}),I))}const p=V(g,e);return{validated:!0,errors:s.errors??(p==null?void 0:p.value),data:void 0}}}else{const d=V(t,r.validationPath);if(!d||d.value===void 0)return u();{const g=await d.value(r.value);return{validated:!0,errors:g&&(s.errors??g),data:void 0}}}}const yt=(e,t=0)=>{const n=e.getBoundingClientRect();return n.top>=t&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)},gt=(e,t=1.125,n="smooth")=>{const s=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:s,behavior:n})};var x;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(x||(x={}));const bt=new Set;let Ne=!1;function pt(e,t,n){let i=x.Idle,o,s,r=!1;const u=bt;function f(){l(),m(i!=x.Delayed?x.Submitting:x.Delayed),o=window.setTimeout(()=>{o&&i==x.Submitting&&m(x.Delayed)},n.delayMs),s=window.setTimeout(()=>{s&&i==x.Delayed&&m(x.Timeout)},n.timeoutMs),u.add(l)}function l(){clearTimeout(o),clearTimeout(s),o=s=0,u.delete(l),m(x.Idle)}function v(){u.forEach(w=>w()),u.clear()}function m(w){i=w,t.submitting.set(i>=x.Submitting),t.delayed.set(i>=x.Delayed),t.timeout.set(i>=x.Timeout)}const d=e;function g(w){const M=w.target;n.selectErrorText&&M.select()}function p(){n.selectErrorText&&d.querySelectorAll("input").forEach(w=>{w.addEventListener("invalid",g)})}function h(){n.selectErrorText&&d.querySelectorAll("input").forEach(w=>w.removeEventListener("invalid",g))}const I=e;function P(w){return typeof n.autoFocusOnError=="boolean"?n.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(w)}const W=async()=>{if(n.scrollToError=="off")return;const w=n.errorSelector;if(!w)return;await Oe();let M;if(M=I.querySelector(w),!M)return;M=M.querySelector(w)??M;const Z=n.stickyNavbar?document.querySelector(n.stickyNavbar):null;if(typeof n.scrollToError!="string"?M.scrollIntoView(n.scrollToError):yt(M,(Z==null?void 0:Z.offsetHeight)??0)||gt(M,void 0,n.scrollToError),!P(navigator.userAgent))return;let N;if(N=M,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(N.tagName)||(N=N.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),N)try{N.focus({preventScroll:!0}),n.selectErrorText&&N.tagName=="INPUT"&&N.select()}catch{}};{p();const w=(M,Z=!1)=>{l(),M||setTimeout(W),Z&&!r&&v()};return he(()=>{h(),w(!0)}),Ne||(Ie(()=>{r=!0}),qe(M=>{M.type!="enter"&&(r=!1,v())}),Ne=!0),{submitting:()=>{r=!1,f()},completed:w,scrollToFirstError:()=>{setTimeout(W)},isSubmitting:()=>i===x.Submitting||i===x.Delayed}}}function Ce(e){!e.flashMessage||!$e||_e(e)&&(document.cookie=`flash=; Max-Age=0; Path=${e.flashMessage.cookiePath??"/"};`)}function _e(e){return!e.flashMessage||!$e?!1:e.syncFlashMessage}const Le="noCustomValidity";function De(e,t){const n=t&&t.length?t.join(`
`):"";e.setCustomValidity(n),n&&e.reportValidity()}function ht(e,t){for(const n of e.querySelectorAll("input,select,textarea,button")){if(Le in n.dataset)continue;const i=V(t,ue(n.name));if(De(n,i==null?void 0:i.value),i!=null&&i.value)return}}function wt(e,t,n,i,o,s,r,u,f,l,v,m,d,g,p,h,I){l();const P=o;async function W(E,k,A){if(r.validationMethod=="submit-only")return;if(r.customValidity&&A){if("setCustomValidity"in A&&A.setCustomValidity(""),k=="input"&&r.validationMethod=="onblur")return;if(Le in A.dataset){if(k=="input")return;A=null}}const O=await pe(E,r,u,P,g);A&&De(A,O.errors)}function w(E){return E&&(E instanceof HTMLSelectElement||E instanceof HTMLInputElement&&(E.type=="radio"||E.type=="checkbox"))}async function M(E){if(!(r.validationMethod=="oninput"||r.validationMethod=="submit-only")){w(E.target)&&await new Promise(k=>setTimeout(k,0));for(const k of _(p)){let A=null;if(r.customValidity){const O=CSS.escape(be(k));A=e.querySelector(`[name="${O}"]`)}W(k,"blur",A)}p.set([])}}e.addEventListener("focusout",M);async function Z(E){if(!(r.validationMethod=="onblur"||r.validationMethod=="submit-only")){w(E.target)&&await new Promise(k=>setTimeout(k,0));for(const k of _(p)){const A=CSS.escape(be(k)),O=e.querySelector(`[name="${A}"]`);if(!O)continue;const j=V(_(P),k);j&&j.key in j.parent&&setTimeout(()=>W(k,"input",O),0)}}}r.customValidity&&e.addEventListener("input",Z),he(()=>{e.removeEventListener("focusout",M),e.removeEventListener("input",Z)});const N=pt(e,{submitting:t,delayed:n,timeout:i},r);let Y;return Xe(e,async E=>{var ae,te;const k=E.cancel;let A=!1;function O($=!0){return A=!0,$&&N.isSubmitting()&&N.completed(!0),k()}if(E.cancel=O,N.isSubmitting()&&r.multipleSubmits=="prevent")O(!1);else{N.isSubmitting()&&r.multipleSubmits=="abort"&&Y&&Y.abort(),N.submitting(),Y=E.controller;for(const $ of v.onSubmit)await $(E)}if(A)r.flashMessage&&Ce(r);else{const $=await Re(e.noValidate||(E.submitter instanceof HTMLButtonElement||E.submitter instanceof HTMLInputElement)&&E.submitter.formNoValidate?void 0:r.validators,_(u),_(m),_(d),_(I));if(!$.valid){O(!1);const b={type:"failure",status:(typeof r.SPA=="boolean"||(ae=r.SPA)==null?void 0:ae.failStatus)??400,data:{form:$}};setTimeout(()=>R({result:b}),0)}if(!A){switch(r.clearOnSubmit){case"errors-and-message":P.clear(),f.set(void 0);break;case"errors":P.clear();break;case"message":f.set(void 0);break}r.flashMessage&&(r.clearOnSubmit=="errors-and-message"||r.clearOnSubmit=="message")&&_e(r)&&r.flashMessage.module.getFlash(ne).set(void 0);const b="formData"in E?E.formData:E.data;if(r.SPA){O(!1);const T={...$,posted:!0},L={type:T.valid?"success":"failure",status:T.valid?200:typeof r.SPA=="object"?(te=r.SPA)==null?void 0:te.failStatus:400,data:{form:T}};setTimeout(()=>R({result:L}),0)}else if(r.dataType==="json"){const T=$.data,L=j(Ve(T),r.jsonChunkSize??5e5);for(const C of L)b.append("__superform_json",C);Object.keys(T).forEach(C=>{typeof b.get(C)=="string"&&b.delete(C)})}if(!r.SPA&&!b.has("__superform_id")){const T=_(m);T!==void 0&&b.set("__superform_id",T)}}}function j($,b){const T=Math.ceil($.length/b),L=new Array(T);for(let C=0,D=0;C<T;++C,D+=b)L[C]=$.substring(D,D+b);return L}async function R($){const b=$.result;Y=null;let T=!1;const L={result:b,formEl:e,cancel:()=>T=!0};for(const C of v.onResult)await C(L);if(!T){if((b.type==="success"||b.type=="failure")&&b.data){const C=h(b.data);if(!C.length)throw new U("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const D of C){if(D.id!==_(m))continue;const ie={form:D,formEl:e,cancel:()=>T=!0};for(const K of v.onUpdate)await K(ie);!T&&r.customValidity&&ht(e,ie.form.errors)}}if(!T){if(b.type!=="error")b.type==="success"&&r.invalidateAll&&await Be(),r.applyAction?await de(b):await s(b);else{if(r.applyAction)if(r.onError=="apply")await de(b);else{const C={type:"failure",status:Math.floor(b.status||500),data:b};await de(C)}if(r.onError!=="apply"){const C={result:b,message:f};for(const D of v.onError)D!=="apply"&&await D(C)}}r.flashMessage&&b.type=="error"&&r.flashMessage.onError&&await r.flashMessage.onError({result:b,message:r.flashMessage.module.getFlash(ne)})}}T&&r.flashMessage&&Ce(r),T||b.type!="redirect"?N.completed(T):b.type=="redirect"&&new URL(b.location,/^https?:\/\//.test(b.location)?void 0:document.location.origin).pathname==document.location.pathname&&setTimeout(()=>{N.completed(!0,!0)},0)}return R})}new TextEncoder;const vt={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:e=>{console.warn("Unhandled Superform error, use onError event to handle it:",e.result.error)},dataType:"form",validators:void 0,defaultValidator:"keep",customValidity:!1,clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0,SPA:void 0,validateMethod:"auto"},se=new WeakMap,Q=new WeakMap;function St(e){return`Duplicate form id's found: "${e}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}function kt(e,t={}){var Ee,Te;t={...vt,...t},t.SPA&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add them to the validators option, or set it to false to disable this warning.");let n=t.id;!e||g(e)===!1?(((Ee=t.warnings)==null?void 0:Ee.noValidationAndConstraints)!==!1&&console.warn((e?"Form data sent directly to superForm instead of through superValidate. No initial data validation is made. ":"No form data sent to superForm, schema type safety cannot be guaranteed. ")+"Also, no constraints will exist for the form. Set the warnings.noValidationAndConstraints option to false to disable this warning."),e={valid:!1,posted:!1,errors:{},data:e??{},constraints:{}}):n===void 0&&(n=e.id);const i=n,o=_(ne);if(((Te=t.warnings)==null?void 0:Te.duplicateId)!==!1)if(!se.has(o))se.set(o,new Set([i]));else{const a=se.get(o);a!=null&&a.has(i)?console.warn(St(i)):a==null||a.add(i)}Q.has(e)||Q.set(e,G(e));const s=Q.get(e);if(typeof s.valid!="boolean")throw new U("A non-validation object was passed to superForm. It should be an object of type SuperValidated, usually returned from superValidate.");o.form,e=G(s);const r=e,u=H(r.errors),f=H(n),l={taintedMessage:t.taintedMessage,taintedFormState:G(s.data)};function v(a=8){return Math.random().toString(36).substring(2,a+2)}function m(a){l.taintedFormState=G(a)}function d(a){return Object.values(a).filter(y=>g(y)!==!1)}function g(a){return!a||typeof a!="object"||!("valid"in a&&"errors"in a&&typeof a.valid=="boolean")?!1:"id"in a&&typeof a.id=="string"?a.id:void 0}function p(){t.taintedMessage=l.taintedMessage,n===void 0&&f.set(v())}function h(a){const c=H(a);return{subscribe:c.subscribe,set:(y,S={})=>(b(y,l.taintedFormState,S.taint??!0),m(y),c.set(G(y))),update:(y,S={})=>c.update(F=>{const X=y(F);return b(X,l.taintedFormState,S.taint??!0),m(X),X})}}const I=[f.subscribe(a=>n=a)];function P(a){I.push(a)}function W(){I.forEach(a=>a())}const w=h(r.data);function M(a,c){if(!(!c||typeof c!="object")){if(Array.isArray(c))c.length>0&&M(a,c[0]);else if(!(c instanceof Date))throw new U(`Object found in form field "${a}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}}async function Z(a,c){a.valid&&c&&t.resetForm&&(t.resetForm===!0||t.resetForm())?N(a.message):K(a,c),B.onUpdated.length&&await Oe();for(const y of B.onUpdated)y({form:a})}function N(a,c,y){const S=G(s);S.data={...S.data,...c},y!==void 0&&(S.id=y),K(S,!0,a)}const Y=async(a,c)=>{if(a.type=="error")throw new U(`ActionResult of type "${a.type}" cannot be passed to update function.`);if(a.type=="redirect"){t.resetForm&&(t.resetForm===!0||t.resetForm())&&N();return}if(typeof a.data!="object")throw new U("Non-object validation data returned from ActionResult.");const y=d(a.data);if(!y.length)throw new U("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const S of y)S.id===n&&await Z(S,c??(a.status>=200&&a.status<300))},E=H([]),k=H(r.message),A=H(r.constraints),O=H(!1),j={subscribe:u.subscribe,set:u.set,update:u.update,clear:()=>Se(u,{undefinePath:null,clearFormLevelErrors:!0})},R=H();function ae(){return _(R)}function te(a){if(a===null)throw new U("$tainted store contained null");if(typeof a=="object"){for(const c of Object.values(a))if(te(c))return!0}return a===!0}async function $(a,c){let y=t.validationMethod==="oninput";if(!y){const S=_(j),F=S?nt(S,a,{modifier:ce=>{if(we(a,ce))throw new U("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+ce.path.slice(0,-1));return ce.value}}):void 0;y=!!(F&&F.key in F.parent)}return y?(await pe(a,t,w,j,R,{taint:c}),!0):!1}async function b(a,c,y){if(y=="ignore")return;let S=st(a,c);if(typeof y=="object"&&(typeof y.fields=="string"&&(y.fields=[y.fields]),S=y.fields.map(F=>ue(F)),y=!0),E.set(S),S.length&&(y==="untaint-all"?R.set(void 0):R.update(F=>(F||(F={}),J(F,S,y===!0?!0:void 0),F)),!(t.validationMethod=="onblur"||t.validationMethod=="submit-only"))){let F=!1;for(const X of S)F=F||await $(X,y);F||await dt(t,_(w),j,_(R))}}function T(a,c){R.set(a),m(c)}const L=H(!1),C=H(!1),D=H(!1),ie=z(j,a=>a?lt(a):[]);if(t.taintedMessage=void 0,he(()=>{var a;W();for(const c of Object.values(B))c.length=0;(a=se.get(o))==null||a.delete(i)}),t.dataType!=="json")for(const[a,c]of Object.entries(r.data))M(a,c);function K(a,c,y){if(c&&T(typeof c=="boolean"?void 0:c,a.data),y=y??a.message,w.set(a.data,{taint:"ignore"}),k.set(y),j.set(a.errors),f.set(a.id),O.set(a.posted),t.flashMessage&&_e(t)){const S=t.flashMessage.module.getFlash(ne);y&&_(S)===void 0&&S.set(y)}}const B={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};Ie(a=>{if(t.taintedMessage&&!_(L)){const c=ae();c&&te(c)&&!window.confirm(t.taintedMessage)&&a.cancel()}}),P(ne.subscribe(async a=>{if(!t.applyAction)return;t.SPA&&await new Promise(y=>setTimeout(y,0));const c=a.status>=200&&a.status<300;if(a.form&&typeof a.form=="object"){const y=a.form;if(y.type=="error")return;const S=d(y);for(const F of S)F.id!==n||Q.has(F)||(Q.set(F,F),await Z(F,c))}else if(a.data&&typeof a.data=="object"){const y=d(a.data);for(const S of y)S.id!==n||Q.has(S)||K(S,c)}}));const Ze=Object.fromEntries(Object.keys(s.data).map(a=>[a,{name:a,value:oe(w,a),errors:oe(j,a),constraints:oe(A,a)}]));async function He(a,c){return a===void 0?Re(t.validators,_(w),n,_(A),!1):(await pe(ue(a),t,w,j,R,c)).errors}return{form:w,formId:f,errors:j,message:k,constraints:A,fields:Ze,tainted:R,submitting:z(L,a=>a),delayed:z(C,a=>a),timeout:z(D,a=>a),options:t,capture:function(){return{valid:s.valid,posted:_(O),errors:_(j),data:_(w),constraints:_(A),message:_(k),id:n,tainted:_(R)}},restore:function(a){return K(a,a.tainted??!0)},validate:He,enhance:(a,c)=>{if(c){if(c.onError){if(t.onError==="apply")throw new U('options.onError is set to "apply", cannot add any onError events.');if(c.onError==="apply")throw new U('Cannot add "apply" as onError event in use:enhance.');B.onError.push(c.onError)}c.onResult&&B.onResult.push(c.onResult),c.onSubmit&&B.onSubmit.push(c.onSubmit),c.onUpdate&&B.onUpdate.push(c.onUpdate),c.onUpdated&&B.onUpdated.push(c.onUpdated)}return wt(a,L,C,D,j,Y,t,w,k,p,B,f,A,R,E,d,O)},allErrors:ie,posted:O,reset:a=>N(a!=null&&a.keepMessage?_(k):void 0,a==null?void 0:a.data,a==null?void 0:a.id)}}export{Mt as d,kt as s};
